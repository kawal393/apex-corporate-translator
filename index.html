<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>APEX Corporate Translator — Verdict Engine</title>
  <meta name="description" content="Translate corporate language into consequences — fast verdict, no spin."/>

  <style>
    :root{
      --bg0:#05070B; --bg1:#070A12;
      --panel: rgba(255,255,255,.06);
      --panel2: rgba(255,255,255,.035);
      --stroke: rgba(255,255,255,.10);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.62);
      --muted2: rgba(255,255,255,.45);
      --gold:#D6B35A; --gold2:#B99233;
      --blue:#6AA8FF;
      --ok:#34D399; --warn:#FBBF24; --bad:#FB7185;
      --shadow: 0 22px 80px rgba(0,0,0,.55);
      --radius: 22px; --radius2: 16px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: var(--sans);
      color: var(--text);
      background:
        radial-gradient(1200px 700px at 10% -10%, rgba(106,168,255,.16), transparent 60%),
        radial-gradient(1000px 700px at 95% 5%, rgba(214,179,90,.14), transparent 60%),
        radial-gradient(1000px 800px at 50% 120%, rgba(106,168,255,.10), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow-x:hidden;
    }

    body:before{
      content:"";
      position:fixed;
      inset:-20%;
      background:
        radial-gradient(circle at 30% 20%, rgba(214,179,90,.12), transparent 45%),
        radial-gradient(circle at 70% 30%, rgba(106,168,255,.10), transparent 45%),
        url("apex-sigil.png");
      background-repeat:no-repeat;
      background-size: 1100px auto;
      background-position: 50% 22%;
      opacity:.22;
      pointer-events:none;
      z-index:-2;
      transform: translateZ(0);
    }
    body:after{
      content:"";
      position:fixed; inset:0;
      background:
        radial-gradient(circle at 20% 30%, rgba(255,255,255,.08) 1px, transparent 1.2px),
        radial-gradient(circle at 65% 55%, rgba(255,255,255,.06) 1px, transparent 1.2px),
        radial-gradient(circle at 80% 25%, rgba(255,255,255,.05) 1px, transparent 1.2px);
      background-size: 220px 220px, 260px 260px, 320px 320px;
      opacity:.22;
      pointer-events:none;
      z-index:-1;
      animation: drift 18s linear infinite;
    }
    @keyframes drift{ from{transform:translate3d(0,0,0)} to{transform:translate3d(-120px, 80px,0)} }

    .wrap{max-width:1120px;margin:0 auto;padding:26px 16px 70px}

    .topbar{display:flex;align-items:center;justify-content:space-between;gap:14px;margin-bottom:14px}
    .brand{display:flex;align-items:center;gap:12px;min-width:0}
    .sig{
      width:42px;height:42px;border-radius:14px;border:1px solid rgba(255,255,255,.14);
      background:
        radial-gradient(circle at 35% 30%, rgba(214,179,90,.35), transparent 55%),
        radial-gradient(circle at 70% 70%, rgba(106,168,255,.35), transparent 55%),
        linear-gradient(135deg, rgba(214,179,90,.18), rgba(106,168,255,.12));
      box-shadow: 0 12px 34px rgba(0,0,0,.35);
      position:relative; overflow:hidden;
    }
    .sig:after{
      content:""; position:absolute; inset:-40%;
      background: conic-gradient(from 180deg, rgba(214,179,90,.0), rgba(214,179,90,.38), rgba(106,168,255,.32), rgba(214,179,90,.0));
      animation: spin 12s linear infinite; opacity:.85;
    }
    @keyframes spin{to{transform:rotate(360deg)}}
    .brand h1{margin:0;font-size:13px;letter-spacing:.18em;text-transform:uppercase;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .brand .sub{margin-top:3px;font-size:12px;color:var(--muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}

    .pillrow{display:flex;align-items:center;gap:10px;flex-wrap:wrap;justify-content:flex-end}
    .pill{
      display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.22);
      backdrop-filter: blur(10px);
      box-shadow: 0 12px 26px rgba(0,0,0,.30);
      font-size:12px; user-select:none;
    }
    a.pill{text-decoration:none}
    .dot{width:9px;height:9px;border-radius:50%;background:var(--blue);box-shadow:0 0 0 4px rgba(106,168,255,.12)}
    .mono{font-family:var(--mono)}

    .panel{
      border-radius: var(--radius);
      border:1px solid rgba(255,255,255,.12);
      background:
        radial-gradient(900px 340px at 15% 15%, rgba(214,179,90,.16), transparent 60%),
        radial-gradient(900px 360px at 88% 20%, rgba(106,168,255,.14), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.03));
      box-shadow: var(--shadow);
      position:relative;
      overflow:hidden;
      transform: translateZ(0);
    }
    .panel:before{
      content:""; position:absolute; inset:0;
      background: linear-gradient(90deg, rgba(214,179,90,.0), rgba(214,179,90,.10), rgba(106,168,255,.10), rgba(214,179,90,.0));
      opacity:.45; transform: translateX(-45%);
      animation: sweep 8s ease-in-out infinite;
      pointer-events:none;
    }
    @keyframes sweep{0%,100%{transform:translateX(-45%)}50%{transform:translateX(45%)}}

    .hero{padding:22px 18px 16px}
    .heroTop{display:flex;align-items:flex-end;justify-content:space-between;gap:12px;flex-wrap:wrap}
    .hero h2{margin:0;font-size:28px;letter-spacing:.06em;text-transform:uppercase;line-height:1.05}
    .hero h2 span{
      background: linear-gradient(90deg, var(--gold), rgba(255,255,255,.96), var(--blue));
      -webkit-background-clip:text; background-clip:text; color:transparent;
    }
    .hero p{margin:10px 0 0;color:rgba(255,255,255,.82);font-size:13px;line-height:1.45;max-width:820px}

    .grid{display:grid;gap:12px;margin-top:14px}
    @media(min-width: 980px){ .grid{grid-template-columns: 1.2fr .8fr;} }

    .card{
      border-radius: var(--radius2);
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.22);
      backdrop-filter: blur(10px);
      box-shadow: 0 16px 34px rgba(0,0,0,.25);
      padding:14px;
      position:relative;
      overflow:hidden;
    }

    label{display:block;font-size:11px;letter-spacing:.14em;text-transform:uppercase;color:rgba(255,255,255,.58)}
    textarea{
      width:100%;
      min-height:180px;
      margin-top:10px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      color: rgba(255,255,255,.92);
      padding:12px 12px;
      outline:none;
      font-size:13px;
      line-height:1.45;
      resize: vertical;
    }
    textarea::placeholder{color: rgba(255,255,255,.40)}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between;margin-top:10px}

    .btn{
      border:none;cursor:pointer;border-radius:14px;padding:11px 14px;
      font-weight:900;font-size:13px;letter-spacing:.02em;
      color: rgba(10,12,16,.95);
      background: linear-gradient(135deg, var(--gold), var(--gold2));
      box-shadow: 0 16px 34px rgba(214,179,90,.18);
      transition: transform .10s ease, filter .10s ease;
    }
    .btn:hover{transform: translateY(-1px); filter: brightness(1.03)}
    .btn:active{transform: translateY(0px); filter: brightness(.98)}
    .btn2{
      cursor:pointer;border-radius:14px;padding:11px 14px;
      font-weight:900;font-size:13px;color:rgba(255,255,255,.90);
      background: rgba(0,0,0,.22);
      border:1px solid rgba(255,255,255,.14);
      backdrop-filter: blur(10px);
      transition: transform .10s ease, border-color .10s ease;
    }
    .btn2:hover{transform: translateY(-1px); border-color: rgba(214,179,90,.35)}
    .btn2:active{transform: translateY(0px)}

    .pillSmall{
      display:inline-flex;gap:8px;align-items:center;
      padding:10px 12px;border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      font-size:12px;color:var(--muted);
    }

    .kv{display:grid;grid-template-columns: 1fr 1fr 1fr;gap:10px;margin-top:12px}
    @media(max-width:720px){.kv{grid-template-columns:1fr}}
    .k{
      border-radius:14px;border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.16);
      padding:12px;
    }
    .k .t{font-size:11px;letter-spacing:.14em;text-transform:uppercase;color:rgba(255,255,255,.58)}
    .k .v{margin-top:8px;font-weight:900}
    .v.ok{color:var(--ok)} .v.warn{color:var(--warn)} .v.bad{color:var(--bad)} .v.dim{color:rgba(255,255,255,.75)}

    .verdictBox{
      margin-top:12px;
      border-radius:14px;border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.16);
      padding:12px;
    }
    .verdictBox pre{
      margin:0;
      white-space:pre-wrap;
      word-break:break-word;
      font-family: var(--mono);
      font-size:12.5px;
      line-height:1.45;
      color: rgba(255,255,255,.90);
    }

    .footer{
      margin-top:14px;
      color: var(--muted);
      font-size:12px;
      line-height:1.5;
      padding:0 4px;
    }
    .footer a{color:rgba(214,179,90,.95);text-decoration:none;border-bottom:1px dashed rgba(214,179,90,.35)}
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="sig" aria-hidden="true"></div>
        <div style="min-width:0">
          <h1>APEX Corporate Translator</h1>
          <div class="sub">Translate corporate language into consequences — fast verdict, no spin.</div>
        </div>
      </div>
      <div class="pillrow">
        <div class="pill"><span class="dot"></span><span class="mono" id="ready">Ready: —</span></div>
        <a class="pill" href="https://kawal393.github.io/" style="text-decoration:none">
          <span class="muted">APEX</span>&nbsp;<span style="color:rgba(214,179,90,.95);font-weight:900">PORTAL</span>
        </a>
      </div>
    </div>

    <section class="panel hero">
      <div class="heroTop">
        <h2><span>Verdict</span> Engine</h2>
        <div class="pillSmall">Mode: <span class="mono" style="color:rgba(255,255,255,.88)">Public Surface</span></div>
      </div>
      <p>
        Paste an internal email, Slack message, press release, or leadership announcement.
        The engine outputs a clean APEX-style brief — five bullets, consequence-first.
      </p>
    </section>

    <div class="grid">
      <section class="card">
        <label for="msg">Message</label>
        <textarea id="msg" placeholder="Paste corporate email / announcement here…"></textarea>

        <div class="row">
          <div style="display:flex;gap:10px;flex-wrap:wrap">
            <button class="btn" id="run">Translate with APEX</button>
            <button class="btn2" id="examples">See Real Examples</button>
            <button class="btn2" id="clear">Clear</button>
          </div>
          <div class="pillSmall">Local • No upload</div>
        </div>

        <div class="footer" style="padding:0;margin-top:10px">
          Tip: triggers include <span class="mono">exit</span>, <span class="mono">wind down</span>, <span class="mono">restructure</span>, <span class="mono">compliance</span>, <span class="mono">portfolio review</span>.
        </div>
      </section>

      <section class="card">
        <label>Verdict</label>

        <div class="kv">
          <div class="k">
            <div class="t">Tier</div>
            <div class="v dim" id="tier">—</div>
          </div>
          <div class="k">
            <div class="t">Confidence</div>
            <div class="v dim" id="conf">—</div>
          </div>
          <div class="k">
            <div class="t">Status</div>
            <div class="v ok" id="status">READY</div>
          </div>
        </div>

        <div class="verdictBox">
          <div style="display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:10px">
            <div style="font-size:11px;letter-spacing:.14em;text-transform:uppercase;color:rgba(255,255,255,.58)">APEX Verdict (exactly 5 bullets)</div>
            <button class="btn2" id="copy">Copy Verdict</button>
          </div>
          <pre id="out">• No verdict yet. Paste a message and run APEX.</pre>
        </div>

        <div class="row" style="margin-top:10px">
          <button class="btn2" id="download">Download PDF</button>
          <button class="btn2" id="share">Share Link</button>
          <button class="btn2" id="save">Save History</button>
          <button class="btn2" id="history">View History</button>
        </div>

        <div class="footer" style="padding:0;margin-top:10px">
          Surface Nodes: <a href="https://kawal393.github.io/ghost-protocol/">Ghost Protocol</a> •
          <a href="https://kawal393.github.io/ndis-signal-board/">NDIS Watchtower</a>
        </div>
      </section>
    </div>
  </div>

<script>
(() => {
  const $ = (id) => document.getElementById(id);

  function nowStamp(){
    const d = new Date();
    const y = d.getFullYear();
    const m = String(d.getMonth()+1).padStart(2,"0");
    const day = String(d.getDate()).padStart(2,"0");
    const hh = String(d.getHours()).padStart(2,"0");
    const mm = String(d.getMinutes()).padStart(2,"0");
    return `${y}-${m}-${day} ${hh}:${mm}`;
  }

  $("ready").textContent = `Ready: ${nowStamp()}`;

  function pickTier(text){
    const t = text.toLowerCase();
    if(t.includes("banning") || t.includes("investigation") || t.includes("breach")) return ["Drop", "High"];
    if(t.includes("restructure") || t.includes("wind down") || t.includes("cost out") || t.includes("redund")) return ["Hold", "Medium"];
    if(t.includes("expansion") || t.includes("growth") || t.includes("acquire") || t.includes("partnership")) return ["Advance", "Medium"];
    return ["Hold", "Low"];
  }

  function verdictFrom(text){
    const raw = text.trim();
    if(!raw) return null;

    const [tier, conf] = pickTier(raw);

    const triggers = [];
    const t = raw.toLowerCase();
    const map = [
      ["exit", "Exit / sale pressure"],
      ["wind down", "Wind-down language"],
      ["restructure", "Restructure signal"],
      ["redund", "Headcount reduction"],
      ["compliance", "Compliance pressure"],
      ["review", "Portfolio review"],
      ["strategic", "Strategy reframe"],
      ["transform", "Transformation narrative"],
      ["delay", "Delay / slip risk"],
      ["regulat", "Regulatory gravity"],
    ];
    for(const [k, label] of map){
      if(t.includes(k)) triggers.push(label);
      if(triggers.length >= 4) break;
    }

    const why = [
      triggers[0] ? `• ${triggers[0]}` : `• Narrative indicates internal repositioning.`,
      triggers[1] ? `• ${triggers[1]}` : `• Language suggests constraint / pressure management.`,
      triggers[2] ? `• ${triggers[2]}` : `• Watch for downstream customer-impact artifacts.`,
    ].slice(0,3);

    // “Next Cheapest Test” + “Kill Rule” are single gates
    const nextTest = `• Next Cheapest Test: Request the concrete timeline + owner + metric in one reply.`;
    const killRule = `• Kill Rule: If they refuse specifics twice, assume optics > reality and drop.`;

    const bullets = [
      `• Tier: ${tier}`,
      `• Confidence: ${conf}`,
      `• Why:`,
      ...why,
      nextTest,
      killRule
    ];

    // Must output exactly 5 bullets total for the user’s desired format:
    // We enforce: Tier, Confidence, Why (max 3 bullets compressed into 1 line), Next Cheapest Test, Kill Rule
    const whyLine = `• Why: ${why.map(x => x.replace("• ","")).join(" | ").slice(0, 220)}`;
    return [
      `• Tier: ${tier}`,
      `• Confidence: ${conf}`,
      whyLine,
      nextTest,
      killRule
    ].join("\n");
  }

  function setKV(tier, conf){
    $("tier").textContent = tier || "—";
    $("conf").textContent = conf || "—";

    const cls = (v) => v === "High" ? "bad" : (v === "Medium" ? "warn" : "dim");
    $("conf").className = `v ${cls(conf)}`;
    $("tier").className = `v ${tier === "Advance" ? "ok" : (tier === "Drop" ? "bad" : "dim")}`;
  }

  function parseKV(out){
    const tier = (out.match(/Tier:\s*(Advance|Hold|Partner-Only|Drop)/i) || [])[1];
    const conf = (out.match(/Confidence:\s*(Low|Medium|High)/i) || [])[1];
    return {tier: tier || "Hold", conf: conf || "Low"};
  }

  function copyText(text){
    navigator.clipboard?.writeText(text).catch(() => {
      const ta = document.createElement("textarea");
      ta.value = text;
      document.body.appendChild(ta);
      ta.select();
      document.execCommand("copy");
      ta.remove();
    });
  }

  $("run").addEventListener("click", () => {
    const v = verdictFrom($("msg").value);
    if(!v){
      $("out").textContent = "• No verdict yet. Paste a message and run APEX.";
      $("status").textContent = "READY";
      setKV("—","—");
      return;
    }
    $("out").textContent = v;
    const kv = parseKV(v);
    setKV(kv.tier, kv.conf);
    $("status").textContent = "GENERATED";
  });

  $("clear").addEventListener("click", () => {
    $("msg").value = "";
    $("out").textContent = "• No verdict yet. Paste a message and run APEX.";
    $("status").textContent = "READY";
    setKV("—","—");
  });

  $("examples").addEventListener("click", () => {
    $("msg").value =
`Subject: Strategic Review Update

We are conducting a portfolio review and exploring strategic options to simplify operations. In the coming weeks, teams should prioritize compliance readiness and cost discipline. Some initiatives may be paused as we recalibrate resources and align to our long-term priorities.`;
  });

  $("copy").addEventListener("click", () => copyText($("out").textContent));

  // Simple local history
  const KEY = "apex_translator_history";
  $("save").addEventListener("click", () => {
    const entry = {ts: nowStamp(), msg: $("msg").value.slice(0,2000), out: $("out").textContent.slice(0,3000)};
    const arr = JSON.parse(localStorage.getItem(KEY) || "[]");
    arr.unshift(entry);
    localStorage.setItem(KEY, JSON.stringify(arr.slice(0,25)));
    $("status").textContent = "SAVED";
  });

  $("history").addEventListener("click", () => {
    const arr = JSON.parse(localStorage.getItem(KEY) || "[]");
    if(!arr.length){ alert("No history yet."); return; }
    const lines = arr.slice(0,10).map((e,i)=>`${i+1}) ${e.ts}\n${e.out}`).join("\n\n— — —\n\n");
    alert(lines);
  });

  $("share").addEventListener("click", () => {
    const msg = $("msg").value.trim();
    if(!msg){ alert("Paste a message first."); return; }
    const url = new URL(location.href);
    url.searchParams.set("m", btoa(unescape(encodeURIComponent(msg))).slice(0,1800));
    copyText(url.toString());
    alert("Link copied.");
  });

  // Read shared link
  try{
    const m = new URL(location.href).searchParams.get("m");
    if(m){
      const decoded = decodeURIComponent(escape(atob(m)));
      $("msg").value = decoded;
    }
  }catch(e){}

  $("download").addEventListener("click", () => {
    // Minimal “pseudo-PDF”: download as .txt for now (works everywhere)
    const blob = new Blob([$(`out`).textContent], {type:"text/plain;charset=utf-8"});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "APEX_Verdict.txt";
    a.click();
    URL.revokeObjectURL(a.href);
  });
})();
</script>
</body>
</html>
