<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>APEX Corporate Translator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="APEX Corporate Translator ‚Äî translate corporate emails into plain consequences. Fast verdict: WATCH / HIGH / CRITICAL."/>
  <style>
    :root{
      --bg:#0b0f14;
      --panel:#121826;
      --panel2:#0f1522;
      --text:#eaeaea;
      --muted:rgba(234,234,234,.72);
      --muted2:rgba(234,234,234,.55);
      --border:rgba(255,255,255,.08);
      --accent:#4f8cff;
      --accent2:#65d6ff;
      --warn:#ffcc66;
      --high:#ff8a66;
      --crit:#ff4d4d;
      --ok:#8cff9a;
      --shadow: 0 20px 70px rgba(0,0,0,.45);
      --radius: 16px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:var(--sans);
      background: radial-gradient(1200px 800px at 50% -10%, rgba(79,140,255,.18), transparent 55%),
                  radial-gradient(900px 600px at 15% 110%, rgba(101,214,255,.10), transparent 55%),
                  var(--bg);
      color:var(--text);
      min-height:100vh;
      display:flex;
      justify-content:center;
      padding:28px 14px;
    }
    .wrap{
      width:100%;
      max-width:980px;
    }
    .topbar{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:14px;
      margin-bottom:18px;
    }
    .brand{
      display:flex;
      align-items:center;
      gap:10px;
      letter-spacing:-.2px;
    }
    .logo{
      width:34px;height:34px;border-radius:10px;
      background: linear-gradient(135deg, rgba(79,140,255,1), rgba(101,214,255,1));
      box-shadow: 0 10px 30px rgba(79,140,255,.25);
      position:relative;
    }
    .logo:after{
      content:"";
      position:absolute; inset:10px;
      border-radius:7px;
      background:rgba(0,0,0,.22);
      border:1px solid rgba(255,255,255,.18);
    }
    .brand h1{
      margin:0;
      font-size:18px;
      font-weight:800;
    }
    .brand .sub{
      margin:0;
      font-size:12px;
      color:var(--muted2);
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 12px;
      border-radius:999px;
      border:1px solid var(--border);
      background:rgba(255,255,255,.03);
      color:var(--muted);
      font-size:12px;
      user-select:none;
    }
    .dot{
      width:8px;height:8px;border-radius:999px;background:var(--ok);
      box-shadow:0 0 0 4px rgba(140,255,154,.14);
    }

    .grid{
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap:16px;
    }
    @media (max-width: 940px){
      .grid{grid-template-columns:1fr}
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .cardhead{
      padding:16px 16px 12px;
      border-bottom:1px solid var(--border);
      background: rgba(0,0,0,.14);
    }
    .cardhead h2{
      margin:0 0 6px;
      font-size:18px;
      font-weight:800;
      letter-spacing:-.2px;
    }
    .cardhead p{
      margin:0;
      color:var(--muted);
      font-size:13px;
      line-height:1.35;
    }
    .content{
      padding:16px;
    }

    textarea{
      width:100%;
      min-height:220px;
      resize:vertical;
      border-radius:14px;
      border:1px solid var(--border);
      background: rgba(0,0,0,.20);
      color:var(--text);
      padding:14px 14px 44px;
      font-size:14px;
      line-height:1.5;
      outline:none;
    }
    textarea:focus{border-color: rgba(79,140,255,.55); box-shadow: 0 0 0 4px rgba(79,140,255,.12);}
    .helper{
      display:flex;
      justify-content:space-between;
      gap:10px;
      margin-top:10px;
      color:var(--muted2);
      font-size:12px;
    }
    .hint{max-width:72%}
    .count{
      font-family:var(--mono);
      opacity:.85;
    }

    .btnrow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:12px;
    }
    button{
      border:none;
      cursor:pointer;
      border-radius:12px;
      padding:12px 14px;
      font-weight:800;
      font-size:13px;
      color:#0b0f14;
      background: linear-gradient(135deg, rgba(79,140,255,1), rgba(101,214,255,1));
      box-shadow: 0 12px 30px rgba(79,140,255,.20);
      transition: transform .06s ease, filter .2s ease;
    }
    button:active{transform:scale(.99)}
    button.secondary{
      background: rgba(255,255,255,.06);
      color:var(--text);
      border:1px solid var(--border);
      box-shadow:none;
    }
    button.secondary:hover{filter:brightness(1.08)}
    button.ghost{
      background: transparent;
      color:var(--text);
      border:1px dashed rgba(255,255,255,.18);
      box-shadow:none;
    }
    button:disabled{
      opacity:.55;
      cursor:not-allowed;
      filter:saturate(.4);
    }

    .out{
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    .alert{
      border-radius:14px;
      border:1px solid var(--border);
      background: rgba(0,0,0,.22);
      padding:14px;
    }
    .alerttop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      margin-bottom:10px;
    }
    .apex{
      display:flex;
      align-items:center;
      gap:10px;
      font-weight:900;
      letter-spacing:.2px;
    }
    .badge{
      padding:7px 10px;
      border-radius:999px;
      font-size:12px;
      font-weight:900;
      border:1px solid var(--border);
      background: rgba(255,255,255,.04);
    }
    .badge.crit{color:var(--crit); border-color: rgba(255,77,77,.35); background: rgba(255,77,77,.08)}
    .badge.high{color:var(--high); border-color: rgba(255,138,102,.35); background: rgba(255,138,102,.08)}
    .badge.watch{color:var(--warn); border-color: rgba(255,204,102,.35); background: rgba(255,204,102,.08)}
    .kv{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      color:var(--muted);
      font-size:12px;
    }
    .kv b{color:var(--text)}
    .riskline{
      margin-top:6px;
      color:var(--muted);
      font-size:13px;
      line-height:1.35;
    }
    .bullets{
      margin:12px 0 0;
      padding-left:18px;
      color:var(--text);
      line-height:1.45;
      font-size:14px;
    }
    .bullets li{
      margin:8px 0;
    }
    .meta{
      margin-top:10px;
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      color:var(--muted2);
      font-size:12px;
    }
    .meta .stamp{
      font-family:var(--mono);
      opacity:.95;
    }

    .probar{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:12px;
    }
    .probtn{
      flex:1;
      min-width:180px;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      padding:12px 12px;
      border-radius:12px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.03);
      color:var(--muted);
      font-weight:800;
      font-size:13px;
      cursor:pointer;
      user-select:none;
    }
    .probtn.locked{
      opacity:.78;
    }
    .lock{
      width:16px;height:16px; display:inline-block;
      border-radius:6px;
      background: rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.16);
      position:relative;
    }
    .lock:before{
      content:"";
      position:absolute;
      width:8px;height:8px;
      border:2px solid rgba(255,255,255,.55);
      border-bottom:0;
      border-radius:8px 8px 0 0;
      left:50%;
      transform:translateX(-50%);
      top:2px;
    }
    .lock:after{
      content:"";
      position:absolute;
      width:8px;height:6px;
      background: rgba(255,255,255,.18);
      border:1px solid rgba(255,255,255,.22);
      border-radius:3px;
      left:50%;
      transform:translateX(-50%);
      bottom:2px;
    }

    .mini{
      margin-top:12px;
      color:var(--muted2);
      font-size:12px;
      line-height:1.35;
    }
    .mini a{color:rgba(101,214,255,.92); text-decoration:none}
    .mini a:hover{text-decoration:underline}

    /* Modal */
    .modalback{
      position:fixed; inset:0;
      background: rgba(0,0,0,.6);
      display:none;
      align-items:center;
      justify-content:center;
      padding:18px;
      z-index:9999;
    }
    .modal{
      width:100%;
      max-width:480px;
      border-radius:18px;
      border:1px solid var(--border);
      background: linear-gradient(180deg, rgba(18,24,38,.98), rgba(12,16,22,.98));
      box-shadow: 0 30px 110px rgba(0,0,0,.6);
      overflow:hidden;
    }
    .modal .mh{
      padding:14px 16px;
      border-bottom:1px solid var(--border);
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
    }
    .modal .mh b{font-size:13px; letter-spacing:.2px}
    .xbtn{
      background:transparent;
      border:1px solid var(--border);
      color:var(--text);
      border-radius:10px;
      padding:8px 10px;
      font-weight:900;
      cursor:pointer;
    }
    .modal .mb{
      padding:14px 16px 16px;
      color:var(--muted);
      font-size:13px;
      line-height:1.45;
    }
    .modal .mb ul{margin:10px 0 0; padding-left:18px;}
    .modal .mb li{margin:6px 0}
    .modal .mf{
      padding:14px 16px;
      border-top:1px solid var(--border);
      display:flex;
      justify-content:flex-end;
      gap:10px;
    }

  </style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>APEX Corporate Translator</h1>
          <p class="sub">Translate corporate language into consequences ‚Äî fast verdict, no spin.</p>
        </div>
      </div>
      <div class="pill" title="Live on GitHub Pages">
        <span class="dot"></span>
        Live ‚Ä¢ Free to use
      </div>
    </div>

    <div class="grid">
      <!-- LEFT: INPUT -->
      <div class="card">
        <div class="cardhead">
          <h2>Paste the message</h2>
          <p>Paste an internal email, Slack message, or leadership announcement. For best results, include the subject + opening paragraphs.</p>
        </div>
        <div class="content">
          <textarea id="input" placeholder="Paste corporate email / announcement here..."></textarea>

          <div class="helper">
            <div class="hint">Tip: include words like ‚Äúoperating model‚Äù, ‚Äúover the coming weeks‚Äù, ‚Äúalign resources‚Äù, ‚Äústreamline‚Äù, ‚Äúorganizational adjustments‚Äù.</div>
            <div class="count"><span id="chars">0</span> chars</div>
          </div>

          <div class="btnrow">
            <button id="run">Translate with APEX</button>
            <button id="example" class="secondary">See Real Examples</button>
            <button id="clear" class="ghost">Clear</button>
          </div>

          <div class="mini">
            Built to decode language patterns that commonly appear before restructures, layoffs, and role changes.
          </div>
        </div>
      </div>

      <!-- RIGHT: OUTPUT -->
      <div class="card">
        <div class="cardhead">
          <h2>Verdict</h2>
          <p>APEX outputs exactly five bullets: what‚Äôs happening, why now, what‚Äôs next, who‚Äôs exposed, what to do.</p>
        </div>
        <div class="content">
          <div class="out" id="out">
            <div class="alert">
              <div class="alerttop">
                <div class="apex">üö® APEX ALERT</div>
                <div class="badge watch">Status: WATCH</div>
              </div>
              <div class="kv">
                <span><b>Confidence:</b> Low</span>
              </div>
              <div class="riskline">
                Paste a message and run APEX to get a verdict.
              </div>
              <ol class="bullets">
                <li><span style="color:var(--muted)">No verdict yet.</span></li>
              </ol>
              <div class="meta">
                <span class="stamp" id="stamp">‚Äî</span>
                <button id="copy" class="secondary" style="padding:10px 12px; font-weight:900;">Copy Verdict</button>
              </div>
            </div>

            <div class="probar">
              <div class="probtn locked" data-pro="pdf"><span class="lock"></span> Download PDF (Pro)</div>
              <div class="probtn locked" data-pro="share"><span class="lock"></span> Share Link (Pro)</div>
              <div class="probtn locked" data-pro="history"><span class="lock"></span> Save History (Pro)</div>
            </div>

            <div class="mini">
              Free now. Pro unlocks PDF export, shareable links, and history (week 2+).
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div class="modalback" id="modalBack">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="mh">
        <b id="modalTitle">APEX Pro ‚Äî Coming Soon</b>
        <button class="xbtn" id="modalClose">Close</button>
      </div>
      <div class="mb" id="modalBody">
        Pro features are locked for now.
        <ul>
          <li><b>PDF export</b> (documentation-ready)</li>
          <li><b>Shareable verdict links</b> (send to colleagues)</li>
          <li><b>Verdict history</b> (track patterns over time)</li>
        </ul>
      </div>
      <div class="mf">
        <button class="secondary" id="modalOk" style="padding:10px 12px; font-weight:900;">Got it</button>
      </div>
    </div>
  </div>

  <script>
    // -----------------------------
    // APEX Corporate Translator MVP
    // - Single file, GitHub Pages friendly
    // - No external dependencies
    // - Keeps mechanics hidden; outputs clean verdict only
    // -----------------------------

    const $ = (id) => document.getElementById(id);

    const inputEl = $("input");
    const outEl = $("out");
    const charsEl = $("chars");
    const stampEl = $("stamp");
    const modalBack = $("modalBack");
    const modalClose = $("modalClose");
    const modalOk = $("modalOk");

    inputEl.addEventListener("input", () => {
      charsEl.textContent = String(inputEl.value.length);
    });

    // ---- Examples (realistic patterns, anonymized) ----
    const EXAMPLES = [
      {
        title: "Example ‚Äî CRITICAL (Operating Model)",
        text:
`Subject: Update on Our Operating Model

As we continue to navigate a dynamic market environment, we are reviewing our current operating model to ensure we are best positioned for long-term success.

Over the coming weeks, leadership will be evaluating opportunities to streamline workflows, align resources with strategic priorities, and improve cross-functional efficiency.

Some teams may see changes in scope, ownership, or reporting structures as part of this process. Managers will be sharing additional details as plans are finalized.

We appreciate your flexibility and continued commitment as we work through this transition together.

Senior Leadership Team`
      },
      {
        title: "Example ‚Äî WATCH (Harmless FYI)",
        text:
`Subject: FYI ‚Äî Office Closed Friday

Team, reminder that the office will be closed this Friday for scheduled maintenance.
Please work from home if needed. Thanks.`
      },
      {
        title: "Example ‚Äî CRITICAL (Explicit Impact)",
        text:
`Subject: Organizational Changes

Due to current market conditions, some roles will be eliminated.
Impacted employees will be contacted this week.
More details will be provided shortly.`
      }
    ];

    // ---- Internal signal library (keep hidden from UI) ----
    // Designed to detect common corporate euphemisms that precede restructures / scope cuts.
    // The user sees only status/confidence + five bullets.
    const SIGNALS = [
      // High signal phrases
      { r: /\boperating model\b/i, w: 5, tag: "structure" },
      { r: /\borganizational (adjustments|changes|evolution)\b/i, w: 5, tag: "structure" },
      { r: /\brestructur(ing|e)\b/i, w: 6, tag: "structure" },
      { r: /\brealignment\b/i, w: 5, tag: "structure" },
      { r: /\bstreamlin(e|ing)\b/i, w: 4, tag: "cuts" },
      { r: /\balign (resources|investment|spend)\b/i, w: 4, tag: "cuts" },
      { r: /\boptimi(z|s)ation\b/i, w: 3, tag: "cuts" },
      { r: /\befficien(cy|cies)\b/i, w: 3, tag: "cuts" },
      { r: /\bcost (reduction|discipline|savings)\b/i, w: 6, tag: "cuts" },
      { r: /\bheadcount\b/i, w: 7, tag: "cuts" },
      { r: /\brole(s)? will be eliminated\b/i, w: 9, tag: "impact" },
      { r: /\bimpacted employees\b/i, w: 9, tag: "impact" },
      { r: /\bredundan(cy|cies)\b/i, w: 9, tag: "impact" },
      { r: /\blayoff(s)?\b/i, w: 10, tag: "impact" },

      // Time + ambiguity
      { r: /\bover the coming weeks\b/i, w: 4, tag: "timeline" },
      { r: /\bin the coming weeks\b/i, w: 4, tag: "timeline" },
      { r: /\bdetails will be shared\b/i, w: 3, tag: "ambiguity" },
      { r: /\bas plans are finalized\b/i, w: 3, tag: "ambiguity" },
      { r: /\bmanagers will share\b/i, w: 2, tag: "ambiguity" },
      { r: /\bscope\b/i, w: 2, tag: "structure" },
      { r: /\bownership\b/i, w: 2, tag: "structure" },
      { r: /\breporting (structures|lines)\b/i, w: 4, tag: "structure" },
      { r: /\btransition\b/i, w: 2, tag: "structure" },
      { r: /\bdynamic market\b/i, w: 2, tag: "context" },
      { r: /\bstrategic priorities\b/i, w: 2, tag: "context" },
    ];

    function normalize(text){
      return (text || "").replace(/\s+/g, " ").trim();
    }

    function scoreSignals(text){
      const hits = [];
      let score = 0;
      let unique = 0;

      for (const s of SIGNALS){
        if (s.r.test(text)){
          unique++;
          score += s.w;
          hits.push(s.tag);
        }
      }

      // Tag diversity increases risk quality (structure + timeline + ambiguity is a known pattern)
      const tags = new Set(hits);
      const diversityBonus = Math.max(0, tags.size - 1); // 0..n
      score += diversityBonus;

      // If explicit impact tags appear, hard boost
      if (hits.includes("impact")) score += 3;

      return { score, unique, tags: Array.from(tags) };
    }

    function classify(score, tags){
      // Hard rules
      if (tags.includes("impact")) return { status: "CRITICAL", confidence: "High" };

      // Thresholds
      if (score >= 18) return { status: "CRITICAL", confidence: score >= 24 ? "High" : "Medium" };
      if (score >= 10) return { status: "HIGH", confidence: score >= 14 ? "Medium" : "Low" };
      return { status: "WATCH", confidence: "Low" };
    }

    function guessWindow(tags, score){
      // Tight window when timeline + structure present
      if (tags.includes("timeline") && tags.includes("structure")) return "2‚Äì6 weeks";
      if (score >= 18) return "1‚Äì6 weeks";
      if (score >= 10) return "4‚Äì10 weeks";
      return "No immediate risk window";
    }

    function buildBullets(status, confidence, tags, score, text){
      const window = guessWindow(tags, score);
      const lower = text.toLowerCase();

      // 1) What‚Äôs happening
      let b1 = "Likely organizational change signal (reorg / scope shift) rather than a routine update.";
      if (status === "WATCH") b1 = "This reads as a routine update with no strong restructuring signals.";
      if (tags.includes("impact")) b1 = "This contains explicit impact language (role eliminations / impacted employees).";

      // 2) Why now
      let b2 = "Leadership is preparing alignment: budgets, responsibilities, and team shape.";
      if (lower.includes("dynamic market")) b2 = "‚ÄúMarket conditions‚Äù is being used as the justification for internal change.";
      if (status === "WATCH") b2 = "There‚Äôs no obvious trigger language suggesting restructuring intent.";

      // 3) What comes next
      let b3 = `Next likely step: manager briefings + org mapping. Action window: ${window}.`;
      if (tags.includes("ambiguity")) b3 = `‚ÄúDetails later‚Äù language often means decisions are being finalized now. Window: ${window}.`;
      if (status === "WATCH") b3 = "Next likely step: normal operational follow-up. No escalation implied.";

      // 4) Who‚Äôs exposed
      let b4 = "Teams labeled ‚Äúnon-core‚Äù, ‚Äúefficiency‚Äù, or ‚Äústreamline‚Äù are typically first to be reshaped.";
      if (tags.includes("structure")) b4 = "People affected first are those with shifting scope/ownership/reporting lines.";
      if (tags.includes("impact")) b4 = "If you are in the referenced teams/roles, expect direct contact imminently.";
      if (status === "WATCH") b4 = "No specific group exposure is implied by this message.";

      // 5) What to do now
      let b5 = "Ask your manager 3 specifics: scope changes, reporting changes, and the decision timeline. Document answers.";
      if (status === "CRITICAL") b5 = "Protect yourself: clarify impact + timeline, update options, and document everything now.";
      if (status === "WATCH") b5 = "No urgent action required. Save the message; re-check future updates for pattern shifts.";

      return [b1, b2, b3, b4, b5];
    }

    function riskSummary(status, confidence, tags, score){
      if (status === "WATCH") return "No material restructuring signals detected. Low immediate risk.";
      const window = guessWindow(tags, score);
      if (status === "HIGH") return `Multiple restructuring indicators detected. Action window likely ${window}.`;
      return `Strong restructuring / impact indicators detected. Action window likely ${window}.`;
    }

    function badgeClass(status){
      if (status === "CRITICAL") return "crit";
      if (status === "HIGH") return "high";
      return "watch";
    }

    function renderVerdict(text){
      const t = normalize(text);
      if (!t){
        renderEmpty();
        return;
      }

      const { score, unique, tags } = scoreSignals(t);
      const { status, confidence } = classify(score, tags);
      const bullets = buildBullets(status, confidence, tags, score, t);
      const summary = riskSummary(status, confidence, tags, score);

      const now = new Date();
      stampEl.textContent = `APEX-ID ${hashShort(t)} ‚Ä¢ ${now.toISOString()}`;

      outEl.querySelector(".badge").className = `badge ${badgeClass(status)}`;
      outEl.querySelector(".badge").textContent = `Status: ${status}`;

      outEl.querySelector(".kv").innerHTML = `
        <span><b>Confidence:</b> ${confidence}</span>
      `;

      outEl.querySelector(".riskline").textContent = summary;

      const ol = outEl.querySelector(".bullets");
      ol.innerHTML = bullets.map(b => `<li>${escapeHtml(b)}</li>`).join("");
    }

    function renderEmpty(){
      stampEl.textContent = "‚Äî";
      outEl.querySelector(".badge").className = "badge watch";
      outEl.querySelector(".badge").textContent = "Status: WATCH";
      outEl.querySelector(".kv").innerHTML = `<span><b>Confidence:</b> Low</span>`;
      outEl.querySelector(".riskline").textContent = "Paste a message and run APEX to get a verdict.";
      outEl.querySelector(".bullets").innerHTML = `<li><span style="color:var(--muted)">No verdict yet.</span></li>`;
    }

    // ---- Copy verdict (clean, shareable) ----
    function getVerdictText(){
      const status = outEl.querySelector(".badge").textContent.replace("Status: ","").trim();
      const conf = outEl.querySelector(".kv").textContent.replace(/\s+/g," ").trim();
      const summary = outEl.querySelector(".riskline").textContent.trim();
      const bullets = Array.from(outEl.querySelectorAll(".bullets li")).map(li => li.textContent.trim()).filter(Boolean);
      const stamp = stampEl.textContent.trim();

      return [
        "üö® APEX ALERT",
        `Status: ${status}`,
        conf,
        "",
        `Risk Summary: ${summary}`,
        "",
        "Translation:",
        ...bullets.map((b,i)=>`${i+1}. ${b}`),
        "",
        stamp
      ].join("\n");
    }

    async function copyToClipboard(text){
      try{
        await navigator.clipboard.writeText(text);
        toast("Copied.");
      }catch(e){
        // fallback
        const ta = document.createElement("textarea");
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand("copy");
        document.body.removeChild(ta);
        toast("Copied.");
      }
    }

    // ---- Tiny toast ----
    let toastTimer;
    function toast(msg){
      clearTimeout(toastTimer);
      let t = document.getElementById("toast");
      if(!t){
        t = document.createElement("div");
        t.id = "toast";
        t.style.position="fixed";
        t.style.bottom="18px";
        t.style.left="50%";
        t.style.transform="translateX(-50%)";
        t.style.padding="10px 12px";
        t.style.borderRadius="12px";
        t.style.border="1px solid rgba(255,255,255,.12)";
        t.style.background="rgba(0,0,0,.55)";
        t.style.color="rgba(234,234,234,.92)";
        t.style.fontWeight="900";
        t.style.fontSize="12px";
        t.style.zIndex="99999";
        t.style.boxShadow="0 18px 60px rgba(0,0,0,.45)";
        document.body.appendChild(t);
      }
      t.textContent = msg;
      t.style.display="block";
      toastTimer = setTimeout(()=>{ t.style.display="none"; }, 1200);
    }

    // ---- Modal ----
    function openModal(){
      modalBack.style.display = "flex";
    }
    function closeModal(){
      modalBack.style.display = "none";
    }
    modalClose.addEventListener("click", closeModal);
    modalOk.addEventListener("click", closeModal);
    modalBack.addEventListener("click", (e)=>{ if(e.target === modalBack) closeModal(); });

    document.querySelectorAll(".probtn.locked").forEach(btn=>{
      btn.addEventListener("click", openModal);
    });

    // ---- Buttons ----
    $("run").addEventListener("click", ()=> renderVerdict(inputEl.value));
    $("clear").addEventListener("click", ()=>{
      inputEl.value = "";
      charsEl.textContent = "0";
      renderEmpty();
    });

    $("example").addEventListener("click", ()=>{
      // cycle examples
      const current = normalize(inputEl.value);
      const idx = EXAMPLES.findIndex(e => normalize(e.text) === current);
      const next = EXAMPLES[(idx + 1 + EXAMPLES.length) % EXAMPLES.length];
      inputEl.value = next.text;
      charsEl.textContent = String(inputEl.value.length);
      renderVerdict(inputEl.value);
      toast(next.title);
    });

    $("copy").addEventListener("click", ()=> copyToClipboard(getVerdictText()));

    // ---- Helpers ----
    function escapeHtml(str){
      return (str || "")
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    // Short, non-identifying APEX-ID hash (client-side only)
    async function sha256Hex(text){
      const enc = new TextEncoder().encode(text);
      const buf = await crypto.subtle.digest("SHA-256", enc);
      return Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,"0")).join("");
    }
    function hashShort(text){
      // Fast-ish: use built-in crypto where available, but keep sync fallback
      // We'll do a simple deterministic short hash to avoid async stamping complexity.
      let h = 2166136261;
      for (let i=0;i<text.length;i++){
        h ^= text.charCodeAt(i);
        h += (h<<1) + (h<<4) + (h<<7) + (h<<8) + (h<<24);
      }
      // unsigned to hex
      return (h >>> 0).toString(16).padStart(8,"0").toUpperCase();
    }

    // initial
    renderEmpty();
  </script>
</body>
</html>
