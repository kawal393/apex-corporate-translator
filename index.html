<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>APEX Corporate Translator — Verdict Engine</title>
  <meta name="description" content="Translate corporate language into consequences — fast verdict, no spin."/>

  <style>
    :root{
      --bg0:#05070B; --bg1:#070A12;
      --panel: rgba(255,255,255,.06);
      --panel2: rgba(255,255,255,.035);
      --stroke: rgba(255,255,255,.10);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.62);
      --muted2: rgba(255,255,255,.45);
      --gold:#D6B35A; --gold2:#B99233;
      --blue:#6AA8FF;
      --ok:#34D399; --warn:#FBBF24; --bad:#FB7185;
      --shadow: 0 22px 80px rgba(0,0,0,.55);
      --radius: 22px; --radius2: 16px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: var(--sans);
      color: var(--text);
      background:
        radial-gradient(1200px 700px at 10% -10%, rgba(106,168,255,.16), transparent 60%),
        radial-gradient(1000px 700px at 95% 5%, rgba(214,179,90,.14), transparent 60%),
        radial-gradient(1000px 800px at 50% 120%, rgba(106,168,255,.10), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow-x:hidden;
    }

    /* Content always above effects */
    .wrap{max-width:1120px;margin:0 auto;padding:26px 16px 70px; position:relative; z-index:10;}

    /* Logo veil (uses your uploaded apex-sigil.png if present) */
    body:before{
      content:"";
      position:fixed;
      inset:-20%;
      background:
        radial-gradient(circle at 30% 20%, rgba(214,179,90,.12), transparent 45%),
        radial-gradient(circle at 70% 30%, rgba(106,168,255,.10), transparent 45%),
        url("apex-sigil.png");
      background-repeat:no-repeat;
      background-size: 1100px auto;
      background-position: 50% 22%;
      opacity:.20;
      pointer-events:none;
      z-index:1;
      transform: translateZ(0);
      filter: saturate(1.05) contrast(1.02);
    }

    /* EXTRA: subtle “mist” gradient film */
    body:after{
      content:"";
      position:fixed;
      inset:0;
      background:
        radial-gradient(900px 420px at 50% 15%, rgba(214,179,90,.08), transparent 62%),
        radial-gradient(900px 520px at 55% 65%, rgba(106,168,255,.06), transparent 62%),
        linear-gradient(180deg, rgba(0,0,0,.18), rgba(0,0,0,.38));
      opacity:.55;
      pointer-events:none;
      z-index:2;
    }

    /* REAL PARTICLES CANVAS (always visible, always moving) */
    #apexParticles{
      position:fixed;
      inset:0;
      z-index:3;              /* ABOVE logo veil + mist */
      pointer-events:none;
      opacity:.42;
      mix-blend-mode:screen;
    }

    .topbar{display:flex;align-items:center;justify-content:space-between;gap:14px;margin-bottom:14px}
    .brand{display:flex;align-items:center;gap:12px;min-width:0}
    .sig{
      width:42px;height:42px;border-radius:14px;border:1px solid rgba(255,255,255,.14);
      background:
        radial-gradient(circle at 35% 30%, rgba(214,179,90,.35), transparent 55%),
        radial-gradient(circle at 70% 70%, rgba(106,168,255,.35), transparent 55%),
        linear-gradient(135deg, rgba(214,179,90,.18), rgba(106,168,255,.12));
      box-shadow: 0 12px 34px rgba(0,0,0,.35);
      position:relative; overflow:hidden;
    }
    .sig:after{
      content:""; position:absolute; inset:-40%;
      background: conic-gradient(from 180deg, rgba(214,179,90,.0), rgba(214,179,90,.38), rgba(106,168,255,.32), rgba(214,179,90,.0));
      animation: spin 12s linear infinite; opacity:.85;
    }
    @keyframes spin{to{transform:rotate(360deg)}}
    .brand h1{margin:0;font-size:13px;letter-spacing:.18em;text-transform:uppercase;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .brand .sub{margin-top:3px;font-size:12px;color:var(--muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}

    .pillrow{display:flex;align-items:center;gap:10px;flex-wrap:wrap;justify-content:flex-end}
    .pill{
      display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.22);
      backdrop-filter: blur(10px);
      box-shadow: 0 12px 26px rgba(0,0,0,.30);
      font-size:12px; user-select:none;
    }
    a.pill{text-decoration:none}
    .dot{width:9px;height:9px;border-radius:50%;background:var(--blue);box-shadow:0 0 0 4px rgba(106,168,255,.12)}
    .mono{font-family:var(--mono)}

    .panel{
      border-radius: var(--radius);
      border:1px solid rgba(255,255,255,.12);
      background:
        radial-gradient(900px 340px at 15% 15%, rgba(214,179,90,.16), transparent 60%),
        radial-gradient(900px 360px at 88% 20%, rgba(106,168,255,.14), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.03));
      box-shadow: var(--shadow);
      position:relative;
      overflow:hidden;
      transform: translateZ(0);
    }
    .panel:before{
      content:""; position:absolute; inset:0;
      background: linear-gradient(90deg, rgba(214,179,90,.0), rgba(214,179,90,.10), rgba(106,168,255,.10), rgba(214,179,90,.0));
      opacity:.45; transform: translateX(-45%);
      animation: sweep 8s ease-in-out infinite;
      pointer-events:none;
    }
    @keyframes sweep{0%,100%{transform:translateX(-45%)}50%{transform:translateX(45%)}}

    .hero{padding:22px 18px 16px}
    .heroTop{display:flex;align-items:flex-end;justify-content:space-between;gap:12px;flex-wrap:wrap}
    .hero h2{margin:0;font-size:28px;letter-spacing:.06em;text-transform:uppercase;line-height:1.05}
    .hero h2 span{
      background: linear-gradient(90deg, var(--gold), rgba(255,255,255,.96), var(--blue));
      -webkit-background-clip:text; background-clip:text; color:transparent;
    }
    .hero p{margin:10px 0 0;color:rgba(255,255,255,.82);font-size:13px;line-height:1.45;max-width:820px}

    .grid{display:grid;gap:12px;margin-top:14px}
    @media(min-width: 980px){ .grid{grid-template-columns: 1.2fr .8fr;} }

    .card{
      border-radius: var(--radius2);
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.22);
      backdrop-filter: blur(10px);
      box-shadow: 0 16px 34px rgba(0,0,0,.25);
      padding:14px;
      position:relative;
      overflow:hidden;
      transform: translateZ(0);
    }
    /* subtle 3D edge */
    .card:before{
      content:"";
      position:absolute; inset:0;
      background: radial-gradient(600px 200px at 20% 0%, rgba(214,179,90,.10), transparent 60%),
                  radial-gradient(600px 220px at 80% 0%, rgba(106,168,255,.10), transparent 60%);
      opacity:.55;
      pointer-events:none;
    }

    label{display:block;font-size:11px;letter-spacing:.14em;text-transform:uppercase;color:rgba(255,255,255,.58)}
    textarea{
      width:100%;
      min-height:180px;
      margin-top:10px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      color: rgba(255,255,255,.92);
      padding:12px 12px;
      outline:none;
      font-size:13px;
      line-height:1.45;
      resize: vertical;
      position:relative;
      z-index:1;
    }
    textarea::placeholder{color: rgba(255,255,255,.40)}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between;margin-top:10px; position:relative; z-index:1;}

    .btn{
      border:none;cursor:pointer;border-radius:14px;padding:11px 14px;
      font-weight:900;font-size:13px;letter-spacing:.02em;
      color: rgba(10,12,16,.95);
      background: linear-gradient(135deg, var(--gold), var(--gold2));
      box-shadow: 0 16px 34px rgba(214,179,90,.18);
      transition: transform .10s ease, filter .10s ease;
      position:relative; z-index:1;
    }
    .btn:hover{transform: translateY(-1px); filter: brightness(1.03)}
    .btn:active{transform: translateY(0px); filter: brightness(.98)}
    .btn2{
      cursor:pointer;border-radius:14px;padding:11px 14px;
      font-weight:900;font-size:13px;color:rgba(255,255,255,.90);
      background: rgba(0,0,0,.22);
      border:1px solid rgba(255,255,255,.14);
      backdrop-filter: blur(10px);
      transition: transform .10s ease, border-color .10s ease;
      position:relative; z-index:1;
    }
    .btn2:hover{transform: translateY(-1px); border-color: rgba(214,179,90,.35)}
    .btn2:active{transform: translateY(0px)}

    .pillSmall{
      display:inline-flex;gap:8px;align-items:center;
      padding:10px 12px;border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      font-size:12px;color:var(--muted);
      position:relative; z-index:1;
    }

    .kv{display:grid;grid-template-columns: 1fr 1fr 1fr;gap:10px;margin-top:12px; position:relative; z-index:1;}
    @media(max-width:720px){.kv{grid-template-columns:1fr}}
    .k{
      border-radius:14px;border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.16);
      padding:12px;
    }
    .k .t{font-size:11px;letter-spacing:.14em;text-transform:uppercase;color:rgba(255,255,255,.58)}
    .k .v{margin-top:8px;font-weight:900}
    .v.ok{color:var(--ok)} .v.warn{color:var(--warn)} .v.bad{color:var(--bad)} .v.dim{color:rgba(255,255,255,.75)}

    .verdictBox{
      margin-top:12px;
      border-radius:14px;border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.16);
      padding:12px;
      position:relative; z-index:1;
    }
    .verdictBox pre{
      margin:0;
      white-space:pre-wrap;
      word-break:break-word;
      font-family: var(--mono);
      font-size:12.5px;
      line-height:1.45;
      color: rgba(255,255,255,.90);
    }

    .footer{
      margin-top:14px;
      color: var(--muted);
      font-size:12px;
      line-height:1.5;
      padding:0 4px;
      position:relative; z-index:1;
    }
    .footer a{color:rgba(214,179,90,.95);text-decoration:none;border-bottom:1px dashed rgba(214,179,90,.35)}
  </style>
</head>

<body>

  <!-- MOVING PARTICLES LAYER -->
  <canvas id="apexParticles" aria-hidden="true"></canvas>

  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="sig" aria-hidden="true"></div>
        <div style="min-width:0">
          <h1>APEX Corporate Translator</h1>
          <div class="sub">Translate corporate language into consequences — fast verdict, no spin.</div>
        </div>
      </div>
      <div class="pillrow">
        <div class="pill"><span class="dot"></span><span class="mono" id="ready">Ready: —</span></div>
        <a class="pill" href="https://kawal393.github.io/" style="text-decoration:none">
          <span class="muted">APEX</span>&nbsp;<span style="color:rgba(214,179,90,.95);font-weight:900">PORTAL</span>
        </a>
      </div>
    </div>

    <section class="panel hero">
      <div class="heroTop">
        <h2><span>Verdict</span> Engine</h2>
        <div class="pillSmall">Mode: <span class="mono" style="color:rgba(255,255,255,.88)">Public Surface</span></div>
      </div>
      <p>
        Paste an internal email, Slack message, press release, or leadership announcement.
        The engine outputs a clean APEX-style brief — five bullets, consequence-first.
      </p>
    </section>

    <div class="grid">
      <section class="card">
        <label for="msg">Message</label>
        <textarea id="msg" placeholder="Paste corporate email / announcement here…"></textarea>

        <div class="row">
          <div style="display:flex;gap:10px;flex-wrap:wrap">
            <button class="btn" id="run">Translate with APEX</button>
            <button class="btn2" id="examples">See Real Examples</button>
            <button class="btn2" id="clear">Clear</button>
          </div>
          <div class="pillSmall">Local • No upload</div>
        </div>

        <div class="footer" style="padding:0;margin-top:10px">
          Tip: triggers include <span class="mono">exit</span>, <span class="mono">wind down</span>, <span class="mono">restructure</span>, <span class="mono">compliance</span>, <span class="mono">portfolio review</span>.
        </div>
      </section>

      <section class="card">
        <label>Verdict</label>

        <div class="kv">
          <div class="k">
            <div class="t">Tier</div>
            <div class="v dim" id="tier">—</div>
          </div>
          <div class="k">
            <div class="t">Confidence</div>
            <div class="v dim" id="conf">—</div>
          </div>
          <div class="k">
            <div class="t">Status</div>
            <div class="v ok" id="status">READY</div>
          </div>
        </div>

        <div class="verdictBox">
          <div style="display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:10px">
            <div style="font-size:11px;letter-spacing:.14em;text-transform:uppercase;color:rgba(255,255,255,.58)">APEX Verdict (exactly 5 bullets)</div>
            <button class="btn2" id="copy">Copy Verdict</button>
          </div>
          <pre id="out">• No verdict yet. Paste a message and run APEX.</pre>
        </div>

        <div class="row" style="margin-top:10px">
          <button class="btn2" id="download">Download</button>
          <button class="btn2" id="share">Share Link</button>
          <button class="btn2" id="save">Save History</button>
          <button class="btn2" id="history">View History</button>
        </div>

        <div class="footer" style="padding:0;margin-top:10px">
          Surface Nodes:
          <a href="https://kawal393.github.io/-APEX-GHOST-PROTOCOL/">APEX Ghost Protocol</a> •
          <a href="https://kawal393.github.io/ndis-signal-board/">APEX NDIS Watchtower</a>
        </div>
      </section>
    </div>
  </div>

<script>
(() => {
  const $ = (id) => document.getElementById(id);

  function nowStamp(){
    const d = new Date();
    const y = d.getFullYear();
    const m = String(d.getMonth()+1).padStart(2,"0");
    const day = String(d.getDate()).padStart(2,"0");
    const hh = String(d.getHours()).padStart(2,"0");
    const mm = String(d.getMinutes()).padStart(2,"0");
    return `${y}-${m}-${day} ${hh}:${mm}`;
  }

  $("ready").textContent = `Ready: ${nowStamp()}`;

  function pickTier(text){
    const t = text.toLowerCase();
    if(t.includes("banning") || t.includes("investigation") || t.includes("breach")) return ["Drop", "High"];
    if(t.includes("restructure") || t.includes("wind down") || t.includes("cost out") || t.includes("redund")) return ["Hold", "Medium"];
    if(t.includes("expansion") || t.includes("growth") || t.includes("acquire") || t.includes("partnership")) return ["Advance", "Medium"];
    return ["Hold", "Low"];
  }

  function verdictFrom(text){
    const raw = text.trim();
    if(!raw) return null;

    const [tier, conf] = pickTier(raw);

    const triggers = [];
    const t = raw.toLowerCase();
    const map = [
      ["exit", "Exit / sale pressure"],
      ["wind down", "Wind-down language"],
      ["restructure", "Restructure signal"],
      ["redund", "Headcount reduction"],
      ["compliance", "Compliance pressure"],
      ["review", "Portfolio review"],
      ["strategic", "Strategy reframe"],
      ["transform", "Transformation narrative"],
      ["delay", "Delay / slip risk"],
      ["regulat", "Regulatory gravity"],
    ];
    for(const [k, label] of map){
      if(t.includes(k)) triggers.push(label);
      if(triggers.length >= 4) break;
    }

    const why = [
      triggers[0] ? `• ${triggers[0]}` : `• Narrative indicates internal repositioning.`,
      triggers[1] ? `• ${triggers[1]}` : `• Language suggests constraint / pressure management.`,
      triggers[2] ? `• ${triggers[2]}` : `• Watch for downstream customer-impact artifacts.`,
    ].slice(0,3);

    const nextTest = `• Next Cheapest Test: Request the concrete timeline + owner + metric in one reply.`;
    const killRule = `• Kill Rule: If they refuse specifics twice, assume optics > reality and drop.`;

    const whyLine = `• Why: ${why.map(x => x.replace("• ","")).join(" | ").slice(0, 220)}`;
    return [
      `• Tier: ${tier}`,
      `• Confidence: ${conf}`,
      whyLine,
      nextTest,
      killRule
    ].join("\n");
  }

  function setKV(tier, conf){
    $("tier").textContent = tier || "—";
    $("conf").textContent = conf || "—";

    const cls = (v) => v === "High" ? "bad" : (v === "Medium" ? "warn" : "dim");
    $("conf").className = `v ${cls(conf)}`;
    $("tier").className = `v ${tier === "Advance" ? "ok" : (tier === "Drop" ? "bad" : "dim")}`;
  }

  function parseKV(out){
    const tier = (out.match(/Tier:\s*(Advance|Hold|Partner-Only|Drop)/i) || [])[1];
    const conf = (out.match(/Confidence:\s*(Low|Medium|High)/i) || [])[1];
    return {tier: tier || "Hold", conf: conf || "Low"};
  }

  function copyText(text){
    navigator.clipboard?.writeText(text).catch(() => {
      const ta = document.createElement("textarea");
      ta.value = text;
      document.body.appendChild(ta);
      ta.select();
      document.execCommand("copy");
      ta.remove();
    });
  }

  $("run").addEventListener("click", () => {
    const v = verdictFrom($("msg").value);
    if(!v){
      $("out").textContent = "• No verdict yet. Paste a message and run APEX.";
      $("status").textContent = "READY";
      setKV("—","—");
      return;
    }
    $("out").textContent = v;
    const kv = parseKV(v);
    setKV(kv.tier, kv.conf);
    $("status").textContent = "GENERATED";
  });

  $("clear").addEventListener("click", () => {
    $("msg").value = "";
    $("out").textContent = "• No verdict yet. Paste a message and run APEX.";
    $("status").textContent = "READY";
    setKV("—","—");
  });

  $("examples").addEventListener("click", () => {
    $("msg").value =
`Subject: Strategic Review Update

We are conducting a portfolio review and exploring strategic options to simplify operations. In the coming weeks, teams should prioritize compliance readiness and cost discipline. Some initiatives may be paused as we recalibrate resources and align to our long-term priorities.`;
  });

  $("copy").addEventListener("click", () => copyText($("out").textContent));

  // Local history
  const KEY = "apex_translator_history";
  $("save").addEventListener("click", () => {
    const entry = {ts: nowStamp(), msg: $("msg").value.slice(0,2000), out: $("out").textContent.slice(0,3000)};
    const arr = JSON.parse(localStorage.getItem(KEY) || "[]");
    arr.unshift(entry);
    localStorage.setItem(KEY, JSON.stringify(arr.slice(0,25)));
    $("status").textContent = "SAVED";
  });

  $("history").addEventListener("click", () => {
    const arr = JSON.parse(localStorage.getItem(KEY) || "[]");
    if(!arr.length){ alert("No history yet."); return; }
    const lines = arr.slice(0,10).map((e,i)=>`${i+1}) ${e.ts}\n${e.out}`).join("\n\n— — —\n\n");
    alert(lines);
  });

  $("share").addEventListener("click", () => {
    const msg = $("msg").value.trim();
    if(!msg){ alert("Paste a message first."); return; }
    const url = new URL(location.href);
    url.searchParams.set("m", btoa(unescape(encodeURIComponent(msg))).slice(0,1800));
    copyText(url.toString());
    alert("Link copied.");
  });

  // Read shared link
  try{
    const m = new URL(location.href).searchParams.get("m");
    if(m){
      const decoded = decodeURIComponent(escape(atob(m)));
      $("msg").value = decoded;
    }
  }catch(e){}

  $("download").addEventListener("click", () => {
    const text =
`APEX Corporate Translator — Verdict Brief
Generated: ${nowStamp()}

${$("out").textContent}
`;
    const blob = new Blob([text], {type:"text/plain;charset=utf-8"});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "APEX_Verdict.txt";
    a.click();
    URL.revokeObjectURL(a.href);
  });
})();
</script>

<script>
/* APEX PARTICLES — deterministic moving layer (won't "freeze") */
(() => {
  const canvas = document.getElementById("apexParticles");
  if(!canvas) return;

  const ctx = canvas.getContext("2d", { alpha: true });
  let W=0,H=0,DPR=1;
  let particles=[];
  let raf=0;

  const css = getComputedStyle(document.documentElement);
  const GOLD = (css.getPropertyValue("--gold").trim() || "#D6B35A");
  const BLUE = (css.getPropertyValue("--blue").trim() || "#6AA8FF");

  const settings = {
    count: 78,
    speed: 0.22,
    linkDist: 150,
    starSize: 1.35,
    twinkle: 0.33,
  };

  const reduce = window.matchMedia && window.matchMedia("(prefers-reduced-motion: reduce)").matches;
  if(reduce){
    canvas.style.opacity = ".16";
    return;
  }

  function rand(min,max){ return min + Math.random()*(max-min); }

  function resize(){
    DPR = Math.min(2, window.devicePixelRatio || 1);
    W = Math.floor(innerWidth);
    H = Math.floor(innerHeight);
    canvas.width = Math.floor(W * DPR);
    canvas.height = Math.floor(H * DPR);
    canvas.style.width = W + "px";
    canvas.style.height = H + "px";
    ctx.setTransform(DPR,0,0,DPR,0,0);

    const target = Math.max(48, Math.min(130, Math.floor((W*H)/17000)));
    settings.count = target;
    seed();
  }

  function seed(){
    particles = [];
    for(let i=0;i<settings.count;i++){
      particles.push({
        x: rand(0,W), y: rand(0,H),
        vx: rand(-settings.speed, settings.speed),
        vy: rand(-settings.speed, settings.speed),
        r: rand(0.65, settings.starSize),
        a: rand(0.25, 0.95),
        hue: Math.random() < 0.62 ? "gold" : "blue",
        phase: rand(0, Math.PI*2)
      });
    }
  }

  function draw(){
    ctx.clearRect(0,0,W,H);

    // Very soft glow wash
    const g = ctx.createRadialGradient(W*0.5,H*0.35, 0, W*0.5,H*0.35, Math.max(W,H)*0.9);
    g.addColorStop(0,"rgba(214,179,90,.05)");
    g.addColorStop(0.55,"rgba(106,168,255,.035)");
    g.addColorStop(1,"rgba(0,0,0,0)");
    ctx.fillStyle = g;
    ctx.fillRect(0,0,W,H);

    // Links
    for(let i=0;i<particles.length;i++){
      const p = particles[i];
      for(let j=i+1;j<particles.length;j++){
        const q = particles[j];
        const dx = p.x-q.x, dy=p.y-q.y;
        const d = Math.hypot(dx,dy);
        if(d < settings.linkDist){
          const t = 1 - (d/settings.linkDist);
          ctx.globalAlpha = t*0.20;
          ctx.lineWidth = 1;
          ctx.strokeStyle = (p.hue==="gold" || q.hue==="gold")
            ? "rgba(214,179,90,.55)"
            : "rgba(106,168,255,.55)";
          ctx.beginPath();
          ctx.moveTo(p.x,p.y);
          ctx.lineTo(q.x,q.y);
          ctx.stroke();
        }
      }
    }

    // Particles
    for(const p of particles){
      p.phase += 0.02;
      const tw = 1 + Math.sin(p.phase)*settings.twinkle;

      const color = p.hue === "gold" ? GOLD : BLUE;

      // Glow orb
      ctx.globalAlpha = Math.max(0.06, Math.min(1, p.a*0.9));
      ctx.shadowBlur = 18;
      ctx.shadowColor = color;
      ctx.fillStyle = color;
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.r*tw, 0, Math.PI*2);
      ctx.fill();

      // Core
      ctx.shadowBlur = 0;
      ctx.globalAlpha = Math.max(0.10, Math.min(1, p.a));
      ctx.fillStyle = "rgba(255,255,255,.85)";
      ctx.beginPath();
      ctx.arc(p.x, p.y, Math.max(0.6, p.r*0.52), 0, Math.PI*2);
      ctx.fill();

      // Drift
      p.x += p.vx;
      p.y += p.vy;
      if(p.x < -20) p.x = W+20;
      if(p.x > W+20) p.x = -20;
      if(p.y < -20) p.y = H+20;
      if(p.y > H+20) p.y = -20;
    }

    ctx.globalAlpha = 1;
    raf = requestAnimationFrame(draw);
  }

  window.addEventListener("resize", resize, {passive:true});
  resize();
  cancelAnimationFrame(raf);
  raf = requestAnimationFrame(draw);
})();
</script>

</body>
</html>
